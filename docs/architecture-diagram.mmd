%% Policy Mate â€” End-to-End Compliance Workflow

flowchart LR
    %% User Experience
    subgraph FRONTEND ["ğŸ’» User Experience"]
        USER[ğŸ‘¤ User]
        UI[ğŸ’¬ Next.js Chat UI]
        INSIGHTS[ğŸ“Š Compliance Dashboard]
    end
    
    %% Authentication
    subgraph AUTH ["ğŸ” Authentication"]
        COGNITO[Amazon Cognito]
    end
    
    %% API Layer
    subgraph API ["ğŸŒ API Gateway"]
        APIGW[REST API]
    end
    
    %% AI Processing
    subgraph AIPROCESS ["ğŸ§  AI Processing"]
        LAMBDA[AWS Lambda]
        BEDROCK[ğŸ§  Amazon Bedrock]
    end
    
    %% Storage & Data
    subgraph STORAGE ["ğŸ’¾ Storage & Search"]
        S3[ğŸ“„ Amazon S3]
        DYNAMODB[ğŸ“‹ DynamoDB Tables<br/>files, compliance_jobs, reports]
        OPENSEARCH[ğŸ” OpenSearch]
    end
    
    %% Document Lifecycle
    subgraph LIFECYCLE ["ğŸ“„ Document Lifecycle"]
        UPLOAD[Upload Policy]
        STORE[Store File]
        TRIGGER[Trigger Analysis]
    end
    
    %% User Flow
    USER -->|Upload Policy| UI
    USER -->|Ask Questions| UI
    UI -->|Authenticate| COGNITO
    UI -->|Send Request| APIGW
    
    %% Document Lifecycle Flow
    UI -->|Store File| S3
    S3 -->|Trigger| LAMBDA
    
    %% Processing Flow
    APIGW -->|Invoke| LAMBDA
    LAMBDA -->|Save Metadata| DYNAMODB
    LAMBDA -->|Analyze| BEDROCK
    BEDROCK -->|Query Controls| DYNAMODB
    BEDROCK -->|Search Text| OPENSEARCH
    BEDROCK -->|Gap Analysis + Recommendations| LAMBDA
    
    %% Response Flow
    LAMBDA -->|Return Results| APIGW
    APIGW -->|Display| UI
    UI -->|Show Insights| INSIGHTS
    INSIGHTS -->|View Reports| USER
    
    %% Styling
    classDef aws fill:#FF9900,stroke:#232F3E,stroke-width:2px,color:#fff
    classDef user fill:#4CAF50,stroke:#2E7D32,stroke-width:2px,color:#fff
    classDef ui fill:#2196F3,stroke:#1565C0,stroke-width:2px,color:#fff
    
    class COGNITO,APIGW,LAMBDA,BEDROCK,S3,DYNAMODB,OPENSEARCH aws
    class USER,INSIGHTS user
    class UI ui